# RPS Belief Evaluation System - å°ˆæ¡ˆçµæ§‹æ–‡æª”

## ğŸ“ å°ˆæ¡ˆæ¦‚è¦½

é€™æ˜¯ä¸€å€‹ç”¨æ–¼è©•ä¼° LLM ä¿¡å¿µçš„çŸ³é ­å‰ªåˆ€å¸ƒå¯¦é©—ç³»çµ±ï¼ŒåŒ…å« FastAPI å¾Œç«¯å’Œ React å‰ç«¯ã€‚

## ğŸ—ï¸ æ•´é«”æ¶æ§‹

```
rps/
â”œâ”€â”€ backend/                 # FastAPI å¾Œç«¯
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ main.py         # æ‡‰ç”¨ç¨‹å¼å…¥å£é»
â”‚   â”‚   â”œâ”€â”€ core/           # æ ¸å¿ƒé…ç½®
â”‚   â”‚   â”œâ”€â”€ api/            # API è·¯ç”±å±¤
â”‚   â”‚   â”œâ”€â”€ domain/         # æ¥­å‹™é‚è¼¯å±¤
â”‚   â”‚   â”œâ”€â”€ services/       # å¤–éƒ¨æœå‹™æ•´åˆ
â”‚   â”‚   â””â”€â”€ schemas/        # è³‡æ–™æ¨¡å‹å®šç¾©
â”‚   â”œâ”€â”€ requirements.txt    # Python ä¾è³´
â”‚   â”œâ”€â”€ Dockerfile         # Docker é…ç½®
â”‚   â””â”€â”€ env.example        # ç’°å¢ƒè®Šæ•¸ç¯„ä¾‹
â”œâ”€â”€ src/                    # React å‰ç«¯
â”‚   â”œâ”€â”€ components/         # React çµ„ä»¶
â”‚   â”œâ”€â”€ lib/               # å·¥å…·å‡½æ•¸
â”‚   â””â”€â”€ icon/              # éœæ…‹è³‡æº
â”œâ”€â”€ vite.config.js         # Vite é…ç½®
â”œâ”€â”€ package.json           # Node.js ä¾è³´
â””â”€â”€ index.html             # HTML å…¥å£
```

## ğŸ”§ å¾Œç«¯æ¶æ§‹ (backend/)

### æ ¸å¿ƒæ¨¡çµ„

#### `app/main.py` - æ‡‰ç”¨ç¨‹å¼å…¥å£é»
- **åŠŸèƒ½**: FastAPI æ‡‰ç”¨ç¨‹å¼è¨­å®šå’Œè·¯ç”±è¨»å†Š
- **ä¸»è¦è·è²¬**:
  - è¨­å®š CORS ä¸­é–“ä»¶
  - è¨»å†Šæ‰€æœ‰ API è·¯ç”±
  - æä¾›å¥åº·æª¢æŸ¥ç«¯é»
- **API ç«¯é»**:
  - `GET /health` - å¥åº·æª¢æŸ¥
  - æ•´åˆæ‰€æœ‰å­è·¯ç”±æ¨¡çµ„

#### `app/core/config.py` - é…ç½®ç®¡ç†
- **åŠŸèƒ½**: æ‡‰ç”¨ç¨‹å¼é…ç½®å’Œç’°å¢ƒè®Šæ•¸ç®¡ç†
- **ä¸»è¦è·è²¬**:
  - è¼‰å…¥ç’°å¢ƒè®Šæ•¸
  - å®šç¾© API é…ç½®
  - ç®¡ç† LLM æœå‹™è¨­å®š
- **é…ç½®é …ç›®**:
  - `API_PREFIX`: API è·¯å¾‘å‰ç¶´
  - `CORS_ALLOW_ORIGINS`: CORS è¨­å®š
  - `MODEL_PROVIDER`: LLM æœå‹™æä¾›å•†
  - `OPENAI_API_KEY`: OpenAI API é‡‘é‘°

### API å±¤ (`app/api/v1/`)

#### `routes_simulate.py` - æ¨¡æ“¬è·¯ç”±
- **åŠŸèƒ½**: ç­–ç•¥æ¨¡æ“¬ API
- **ç«¯é»**: `POST /api/v1/simulate`
- **åŠŸèƒ½**: åŸ·è¡Œç­–ç•¥å°æˆ°æ¨¡æ“¬

#### `routes_observer.py` - è§€å¯Ÿè€…è·¯ç”±
- **åŠŸèƒ½**: è§€å¯Ÿè€…é æ¸¬ API
- **ç«¯é»**: `POST /api/v1/observer/predict`
- **åŠŸèƒ½**: ä½¿ç”¨ LLM é æ¸¬ç­–ç•¥å°æˆ°çµæœ

#### `routes_strategies.py` - ç­–ç•¥è¨ˆç®—è·¯ç”±
- **åŠŸèƒ½**: ç­–ç•¥ç›¸é—œè¨ˆç®— API
- **ç«¯é»**:
  - `GET /api/v1/strategies/all` - ç²å–æ‰€æœ‰ç­–ç•¥
  - `POST /api/v1/strategies/matchup` - è¨ˆç®—ç­–ç•¥å°æˆ°
  - `POST /api/v1/strategies/matrix` - è¨ˆç®—ç­–ç•¥çŸ©é™£

#### `routes_player.py` - ç©å®¶è·¯ç”±
- **åŠŸèƒ½**: ç©å®¶è¡Œå‹• API
- **ç«¯é»**: `POST /api/v1/player/act`
- **åŠŸèƒ½**: æ±ºå®šç©å®¶ä¸‹ä¸€æ­¥è¡Œå‹•

#### `routes_eval.py` - è©•ä¼°è·¯ç”±
- **åŠŸèƒ½**: è©•ä¼°æŒ‡æ¨™ API
- **ç«¯é»**: `POST /api/v1/evaluate`
- **åŠŸèƒ½**: è¨ˆç®—å„ç¨®è©•ä¼°æŒ‡æ¨™

### æ¥­å‹™é‚è¼¯å±¤ (`app/domain/`)

#### `strategies.py` - ç­–ç•¥å®šç¾©å’Œè¨ˆç®—
- **åŠŸèƒ½**: çŸ³é ­å‰ªåˆ€å¸ƒç­–ç•¥çš„æ ¸å¿ƒé‚è¼¯
- **ä¸»è¦å…§å®¹**:
  - éœæ…‹ç­–ç•¥å®šç¾© (A-P)
  - å‹•æ…‹ç­–ç•¥å®šç¾© (X/Y/Z)
  - ç­–ç•¥å°æˆ°è¨ˆç®—
  - å‹•æ…‹ç­–ç•¥è¿­ä»£æ”¶æ–‚
- **æ ¸å¿ƒå‡½æ•¸**:
  - `calculate_matchup()`: è¨ˆç®—å°æˆ°çµæœ
  - `resolve_dist()`: è§£æå‹•æ…‹ç­–ç•¥
  - `iterate_dists()`: è¿­ä»£è¨ˆç®—ç©©æ…‹
  - `get_all_strategies()`: ç²å–ç­–ç•¥åˆ—è¡¨

#### `simulator.py` - éŠæˆ²æ¨¡æ“¬å™¨
- **åŠŸèƒ½**: åŸ·è¡ŒéŠæˆ²æ¨¡æ“¬
- **ä¸»è¦è·è²¬**:
  - å–®å›åˆéŠæˆ²é‚è¼¯
  - å¤šå›åˆæ¨¡æ“¬
  - çµ±è¨ˆè¨ˆç®—
- **æ ¸å¿ƒå‡½æ•¸**:
  - `play_round()`: åŸ·è¡Œå–®å›åˆ
  - `simulate()`: æ¨¡æ“¬å¤šå›åˆ

#### `metrics.py` - è©•ä¼°æŒ‡æ¨™
- **åŠŸèƒ½**: è¨ˆç®—å„ç¨®è©•ä¼°æŒ‡æ¨™
- **ä¸»è¦æŒ‡æ¨™**:
  - MAE (å¹³å‡çµ•å°èª¤å·®)
  - RMSE (å‡æ–¹æ ¹èª¤å·®)
  - Brier Score
  - ç›¸é—œä¿‚æ•¸

### æœå‹™å±¤ (`app/services/`)

#### `llm.py` - LLM æœå‹™æ•´åˆ
- **åŠŸèƒ½**: æ•´åˆå¤–éƒ¨ LLM æœå‹™
- **ä¸»è¦è·è²¬**:
  - OpenAI API æ•´åˆ
  - ç­–ç•¥é æ¸¬
  - å‚™ç”¨é æ¸¬é‚è¼¯
- **æ ¸å¿ƒåŠŸèƒ½**:
  - `estimate_payoff()`: ä¸»è¦é æ¸¬å‡½æ•¸
  - `call_openai_for_prediction()`: OpenAI API èª¿ç”¨
  - `analyze_strategy()`: ç­–ç•¥åˆ†æ
  - `fallback_prediction()`: å‚™ç”¨é æ¸¬

### è³‡æ–™æ¨¡å‹å±¤ (`app/schemas/`)

#### `simulate.py` - æ¨¡æ“¬ç›¸é—œæ¨¡å‹
- **åŠŸèƒ½**: å®šç¾© API è«‹æ±‚å’Œå›æ‡‰æ ¼å¼
- **ä¸»è¦æ¨¡å‹**:
  - `SimulateRequest/Response`: æ¨¡æ“¬è«‹æ±‚/å›æ‡‰
  - `StrategyMatchupRequest/Response`: ç­–ç•¥å°æˆ°
  - `StrategyMatrixRequest/Response`: ç­–ç•¥çŸ©é™£
  - `AllStrategiesResponse`: ç­–ç•¥åˆ—è¡¨

#### `observer.py` - è§€å¯Ÿè€…ç›¸é—œæ¨¡å‹
- **åŠŸèƒ½**: è§€å¯Ÿè€…é æ¸¬çš„è³‡æ–™æ¨¡å‹
- **ä¸»è¦æ¨¡å‹**:
  - `ObserverPredictReq/Resp`: é æ¸¬è«‹æ±‚/å›æ‡‰

#### `player.py` - ç©å®¶ç›¸é—œæ¨¡å‹
- **åŠŸèƒ½**: ç©å®¶è¡Œå‹•çš„è³‡æ–™æ¨¡å‹
- **ä¸»è¦æ¨¡å‹**:
  - `PlayerActReq/Resp`: è¡Œå‹•è«‹æ±‚/å›æ‡‰

#### `evaluate.py` - è©•ä¼°ç›¸é—œæ¨¡å‹
- **åŠŸèƒ½**: è©•ä¼°æŒ‡æ¨™çš„è³‡æ–™æ¨¡å‹
- **ä¸»è¦æ¨¡å‹**:
  - `EvaluateRequest/Response`: è©•ä¼°è«‹æ±‚/å›æ‡‰

## ğŸ¨ å‰ç«¯æ¶æ§‹ (src/)

### æ ¸å¿ƒçµ„ä»¶

#### `App.jsx` - ä¸»æ‡‰ç”¨ç¨‹å¼çµ„ä»¶
- **åŠŸèƒ½**: React æ‡‰ç”¨ç¨‹å¼æ ¹çµ„ä»¶
- **ä¸»è¦è·è²¬**: è·¯ç”±ç®¡ç†å’Œæ•´é«”ä½ˆå±€

#### `components/RPSCalculator.jsx` - ä¸»è¦è¨ˆç®—å™¨çµ„ä»¶
- **åŠŸèƒ½**: çŸ³é ­å‰ªåˆ€å¸ƒè¨ˆç®—å™¨çš„ä¸»è¦ä»‹é¢
- **ä¸»è¦è·è²¬**:
  - ç­–ç•¥é¸æ“‡å’Œé¡¯ç¤º
  - å°æˆ°çµæœè¨ˆç®—
  - çŸ©é™£è¦–è¦ºåŒ–
  - æå¤±å‡½æ•¸è¨ˆç®—
- **ç‹€æ…‹ç®¡ç†**:
  - ç­–ç•¥é¸æ“‡ç‹€æ…‹
  - è¨ˆç®—çµæœç‹€æ…‹
  - é¡¯ç¤ºæ¨¡å¼ç‹€æ…‹

### å·¥å…·æ¨¡çµ„

#### `lib/api.js` - API å®¢æˆ¶ç«¯
- **åŠŸèƒ½**: èˆ‡å¾Œç«¯ API çš„çµ±ä¸€ä»‹é¢
- **ä¸»è¦å‡½æ•¸**:
  - `simulate()`: ç­–ç•¥æ¨¡æ“¬
  - `observerPredict()`: è§€å¯Ÿè€…é æ¸¬
  - `calculateStrategyMatchup()`: ç­–ç•¥å°æˆ°
  - `calculateStrategyMatrix()`: ç­–ç•¥çŸ©é™£
  - `getAllStrategies()`: ç²å–ç­–ç•¥åˆ—è¡¨
- **éŒ¯èª¤è™•ç†**: çµ±ä¸€çš„éŒ¯èª¤è™•ç†å’Œå›æ‡‰è§£æ

### éœæ…‹è³‡æº

#### `icon/doraemon.png` - åœ–ç¤ºè³‡æº
- **åŠŸèƒ½**: æ‡‰ç”¨ç¨‹å¼åœ–ç¤º

## ğŸ”„ è³‡æ–™æµç¨‹

### 1. ç­–ç•¥è¨ˆç®—æµç¨‹
```
å‰ç«¯é¸æ“‡ç­–ç•¥ â†’ API è«‹æ±‚ â†’ å¾Œç«¯é©—è­‰ â†’ ç­–ç•¥è¨ˆç®— â†’ è¿”å›çµæœ â†’ å‰ç«¯é¡¯ç¤º
```

### 2. LLM é æ¸¬æµç¨‹
```
ç­–ç•¥æè¿° â†’ OpenAI API â†’ é æ¸¬çµæœ â†’ ä¿¡å¿ƒåº¦è©•ä¼° â†’ è¿”å›å‰ç«¯
```

### 3. çŸ©é™£è¨ˆç®—æµç¨‹
```
é¸æ“‡é æ¸¬ç­–ç•¥ â†’ è¨ˆç®—å®Œæ•´çŸ©é™£ â†’ è¨ˆç®—æå¤±å‡½æ•¸ â†’ è¦–è¦ºåŒ–é¡¯ç¤º
```

## ğŸš€ é‹è¡Œæ–¹å¼

### å¾Œç«¯å•Ÿå‹•
```bash
cd backend
uvicorn app.main:app --reload --port 8000
```

### å‰ç«¯å•Ÿå‹•
```bash
npm run dev
```

### ç’°å¢ƒé…ç½®
```bash
# è¤‡è£½ç’°å¢ƒè®Šæ•¸ç¯„ä¾‹
cp backend/env.example backend/.env

# è¨­å®š OpenAI API é‡‘é‘°
echo "OPENAI_API_KEY=your_api_key_here" >> backend/.env
```

## ğŸ“Š API ç«¯é»ç¸½è¦½

| æ–¹æ³• | ç«¯é» | åŠŸèƒ½ | æè¿° |
|------|------|------|------|
| GET | `/health` | å¥åº·æª¢æŸ¥ | æª¢æŸ¥æœå‹™ç‹€æ…‹ |
| POST | `/api/v1/simulate` | ç­–ç•¥æ¨¡æ“¬ | åŸ·è¡Œç­–ç•¥å°æˆ°æ¨¡æ“¬ |
| POST | `/api/v1/observer/predict` | è§€å¯Ÿè€…é æ¸¬ | LLM é æ¸¬å°æˆ°çµæœ |
| POST | `/api/v1/strategies/matchup` | ç­–ç•¥å°æˆ° | è¨ˆç®—å…©å€‹ç­–ç•¥çš„å°æˆ°çµæœ |
| POST | `/api/v1/strategies/matrix` | ç­–ç•¥çŸ©é™£ | è¨ˆç®—å®Œæ•´çš„ç­–ç•¥çŸ©é™£ |
| GET | `/api/v1/strategies/all` | ç­–ç•¥åˆ—è¡¨ | ç²å–æ‰€æœ‰å¯ç”¨ç­–ç•¥ |
| POST | `/api/v1/player/act` | ç©å®¶è¡Œå‹• | æ±ºå®šç©å®¶ä¸‹ä¸€æ­¥è¡Œå‹• |
| POST | `/api/v1/evaluate` | è©•ä¼°æŒ‡æ¨™ | è¨ˆç®—è©•ä¼°æŒ‡æ¨™ |

## ğŸ”§ æŠ€è¡“æ£§

### å¾Œç«¯
- **FastAPI**: Web æ¡†æ¶
- **Pydantic**: è³‡æ–™é©—è­‰
- **OpenAI**: LLM æœå‹™
- **NumPy**: æ•¸å€¼è¨ˆç®—

### å‰ç«¯
- **React**: UI æ¡†æ¶
- **Vite**: å»ºæ§‹å·¥å…·
- **Tailwind CSS**: æ¨£å¼æ¡†æ¶

### é–‹ç™¼å·¥å…·
- **Docker**: å®¹å™¨åŒ–
- **ESLint**: ç¨‹å¼ç¢¼æª¢æŸ¥
- **Prettier**: ç¨‹å¼ç¢¼æ ¼å¼åŒ–

## ğŸ“ é–‹ç™¼æŒ‡å—

### æ·»åŠ æ–°ç­–ç•¥
1. åœ¨ `backend/app/domain/strategies.py` ä¸­æ·»åŠ ç­–ç•¥å®šç¾©
2. æ›´æ–° `BASE_STRATEGIES` æˆ– `DYNAMIC_STRATEGIES`
3. æ¸¬è©¦ç­–ç•¥è¨ˆç®—é‚è¼¯

### æ·»åŠ æ–° API ç«¯é»
1. åœ¨ `app/api/v1/` ä¸­å‰µå»ºæ–°çš„è·¯ç”±æª”æ¡ˆ
2. åœ¨ `app/schemas/` ä¸­å®šç¾©è³‡æ–™æ¨¡å‹
3. åœ¨ `app/main.py` ä¸­è¨»å†Šè·¯ç”±
4. åœ¨ `src/lib/api.js` ä¸­æ·»åŠ å‰ç«¯èª¿ç”¨å‡½æ•¸

### æ•´åˆæ–°çš„ LLM æœå‹™
1. åœ¨ `app/services/llm.py` ä¸­æ·»åŠ æ–°çš„æœå‹™å‡½æ•¸
2. æ›´æ–°é…ç½®ç®¡ç†
3. æ·»åŠ éŒ¯èª¤è™•ç†å’Œå‚™ç”¨é‚è¼¯

## ğŸ§ª æ¸¬è©¦

### API æ¸¬è©¦
```bash
# å¥åº·æª¢æŸ¥
curl http://localhost:8000/health

# ç­–ç•¥å°æˆ°
curl -X POST http://localhost:8000/api/v1/strategies/matchup \
  -H "Content-Type: application/json" \
  -d '{"strategy1": "A", "strategy2": "B"}'
```

### å‰ç«¯æ¸¬è©¦
```bash
# å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨
npm run dev

# è¨ªå•æ‡‰ç”¨ç¨‹å¼
open http://localhost:5173
```

## ğŸ“š åƒè€ƒè³‡æ–™

- [FastAPI æ–‡æª”](https://fastapi.tiangolo.com/)
- [React æ–‡æª”](https://react.dev/)
- [OpenAI API æ–‡æª”](https://platform.openai.com/docs)
- [çŸ³é ­å‰ªåˆ€å¸ƒç­–ç•¥ç†è«–](https://en.wikipedia.org/wiki/Rock_paper_scissors)
